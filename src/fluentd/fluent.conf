<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter **>
  @type parser
  key_name log
  format nginx
</filter>

<filter **>
  @type parser
  key_name log
  format json
</filter>

<filter **>
  @type parser
  key_name log
  format grok
  grok_pattern ?<timestamp>%{YEAR}-%{MONTHNUM}-%{MONTHDAY} %{TIME})\s*%{LOGLEVEL:level}\s*%{NUMBER:pid}\s*---\s*\[(?<thread>.+)\] (?<appkind>.+?):\s+(?<logmessage>.*)
</filter>

<filter **>
  @type parser
  key_name log
  format grok
  grok_pattern (?<timestamp>%{YEAR}-%{MONTHNUM}-%{MONTHDAY} %{TIME})\s*%{LOGLEVEL:level}\s*\[(?<servicename>.+)\]\s*%{NUMBER:pid}\s*---\s*\[(?<thread>.+)\] (?<appkind>.+?):\s+(?<logmessage>.*)
</filter>

<filter **>
@type parser
  key_name log
  format grok
  grok_pattern (?<ipaddr>%{IPV4})\s*-\s*-\s*\[(?<timestamp>%{MONTHDAY}\/%{MONTH}\/%{YEAR}:%{HOUR}:%{MINUTE}:%{SECOND})\s*\+[0-9]{4}\]\s*(?<message>%{QUOTEDSTRING})\s*(?<returncode>[0-9]{3})\s*(?<scode>[0-9]{1})\s*(?<smessage>%{QUOTEDSTRING})\s*(?<component>%{QUOTEDSTRING})
</filter>

<match *.**>
  @type copy
  <store>
    @type elasticsearch
    host elasticsearch 
    port 9200
    logstash_format true
    logstash_prefix fluentd
    logstash_dateformat %Y%m%d
    include_tag_key true
    type_name access_log
    tag_key @log_name
    flush_interval 1s
  </store>
  <store>
    @type stdout
  </store>
</match>